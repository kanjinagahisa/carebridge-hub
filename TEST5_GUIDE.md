# テスト5: パスワード強度ルールの検証 - 実施ガイド

## 📋 事前準備

### ステップ1: パスワード再設定ページへのアクセス準備

1. ブラウザで以下にアクセス:
   ```
   http://localhost:3000/auth/forgot-password
   ```

2. テスト用のメールアドレスを入力（登録済みのユーザー）

3. 「送信する」をクリック

4. メールが送信されたら、メール内のURLをコピーする
   - メールには以下のようなURLが含まれます:
   ```
   http://localhost:3000/auth/reset-password#access_token=...&type=recovery
   ```

5. そのURLをブラウザで開く

---

## 🔴 NGパターンのテスト

### テストケース 5-1: `abcdefgh`（小文字のみ）

**手順:**
1. パスワード入力欄に `abcdefgh` を入力
2. 「送信する」ボタンをクリック

**期待結果:**
- ✅ 入力欄の下に赤枠のエラーメッセージが表示される
- ✅ エラーメッセージ内容:
  ```
  パスワードは、半角英小文字、半角英大文字、半角数字、記号のうち3種類以上を含む必要があります
  ```
- ✅ ブラウザの開発者ツール（F12）→ Networkタブ で確認:
  - Supabaseへの `updateUser` リクエストが **送信されていない**
- ✅ Consoleタブにエラーが出ていない

**確認方法:**
1. ブラウザの開発者ツールを開く（F12 または 右クリック→検証）
2. Networkタブを開く
3. フィルターに `supabase` と入力
4. パスワードを入力して「送信する」をクリック
5. Networkタブに新しいリクエストが表示されないことを確認

---

### テストケース 5-2: `ABCDEFGH`（大文字のみ）

**手順:**
1. パスワード入力欄をクリア（既存のエラーメッセージが消えることを確認）
2. `ABCDEFGH` を入力
3. 「送信する」ボタンをクリック

**期待結果:**
- ✅ テストケース5-1と同じエラーメッセージが表示される
- ✅ Networkタブにリクエストが送信されていない

---

### テストケース 5-3: `12345678`（数字のみ）

**手順:**
1. パスワード入力欄をクリア
2. `12345678` を入力
3. 「送信する」ボタンをクリック

**期待結果:**
- ✅ テストケース5-1と同じエラーメッセージが表示される
- ✅ Networkタブにリクエストが送信されていない

---

### テストケース 5-4: `abcABC12`（小文字・大文字・数字のみ、記号なし）

**手順:**
1. パスワード入力欄をクリア
2. `abcABC12` を入力
3. 「送信する」ボタンをクリック

**期待結果:**
- ⚠️ **注意**: 現在の実装では、このパスワードは「3種類以上の文字種」を含んでいるため、**有効**と判定される可能性があります
- もしエラーが出ない場合は、実装を確認する必要があります

**実装確認が必要な場合:**
- テスト仕様では「記号なし」をNGとしていますが、実装では「3種類以上」でOKのため、仕様と実装が一致していない可能性があります

---

## ✅ OKパターンのテスト

### テストケース 5-5: `abcDEF12!`（4種類すべて）

**手順:**
1. 新しいパスワード再設定URLを取得（必要に応じて）
2. パスワード入力欄に `abcDEF12!` を入力
3. 「送信する」ボタンをクリック

**期待結果:**
- ✅ エラーメッセージが表示されない
- ✅ ボタンが「設定中...」に変わる（ローディング状態）
- ✅ Networkタブで確認:
  - Supabaseへの `updateUser` リクエストが送信される
  - ステータスコードが `200` または `204` で成功
- ✅ 自動的に `/login?message=password-reset-success` にリダイレクトされる
- ✅ Consoleタブにエラーが出ていない

**確認方法:**
1. Networkタブを開いたまま
2. パスワードを入力して「送信する」をクリック
3. Networkタブで `auth/v1/user` または `updateUser` というリクエストを探す
4. そのリクエストをクリックして、Responseタブで成功レスポンスを確認

---

### テストケース 5-6: `Aa1!aaaa`（3種類以上）

**手順:**
1. 新しいパスワード再設定URLを取得（前回のテストで使用したURLは既に使用済みの可能性があります）
2. パスワード入力欄に `Aa1!aaaa` を入力
3. 「送信する」ボタンをクリック

**期待結果:**
- ✅ テストケース5-5と同じ成功動作

---

## 🔍 追加確認事項

### 1. パスワード表示機能の確認
- 「パスワードを表示する」チェックボックスにチェックを入れる
- 入力中のパスワードが平文で表示されることを確認
- チェックを外すと伏字に戻ることを確認

### 2. エラーメッセージの自動クリア
- エラーメッセージが表示されている状態で、パスワード入力欄に文字を入力すると
- エラーメッセージが自動的に消えることを確認

### 3. 画面の表示確認
- パスワード強度の説明文が表示されている:
  ```
  半角英小文字、半角英大文字、半角数字、記号のうち3種類以上を含む（記号は必須）
  ```
- フォームのレイアウトが崩れていない
- ボタンが適切なサイズで表示されている

---

## 📊 テスト結果の記録

各テストケースの結果を記録してください:

| テストケース | パスワード | 期待結果 | 実際の結果 | 備考 |
|------------|----------|---------|-----------|------|
| 5-1 | `abcdefgh` | エラー表示 | ✅ 合格 | エラー正しく表示 |
| 5-2 | `ABCDEFGH` | エラー表示 | ✅ 合格 | エラー正しく表示 |
| 5-3 | `12345678` | エラー表示 | ✅ 合格 | エラー正しく表示 |
| 5-4 | `abcABC12` | エラー表示 | ✅ 合格 | 記号必須の修正により正常動作 |
| 5-5 | `abcDEF12!` | 成功 | ✅ 合格 | パスワード更新成功、ログイン画面へリダイレクト |
| 5-6 | `Aa1!aaaa` | 成功 | ✅ 合格 | パスワード更新成功、ログイン画面へリダイレクト |

**テスト5の結果: ✅ すべて合格**

---

## 🐛 問題が見つかった場合

もし問題が見つかった場合は、以下を確認してください:

1. **ブラウザのConsoleタブ**でエラーメッセージを確認
2. **Networkタブ**でリクエスト/レスポンスの詳細を確認
3. エラーのスクリーンショットを取得
4. 問題の詳細を記録

---

## ✅ 合格条件

以下のすべてが満たされれば合格です:

- ✅ NGパターン（5-1, 5-2, 5-3, 5-4）でエラーが正しく表示される
- ✅ NGパターンでSupabaseへのリクエストが送信されない
- ✅ OKパターン（5-5, 5-6）で正常にパスワードが更新される
- ✅ OKパターンでログイン画面にリダイレクトされる
- ✅ Consoleにエラーが出ていない

**テスト5の判定: ✅ すべての条件を満たしているため、合格です！**

---

## 📝 注意事項

- パスワード再設定URLは**1回しか使用できません**
- 複数のテストケースを実施する場合は、それぞれ新しいメールを送信する必要があります
- テスト用ユーザーのパスワードが変更されるため、ログイン時に新しいパスワードを使用してください

