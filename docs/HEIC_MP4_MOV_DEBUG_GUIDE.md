# HEIC/MP4/MOV ファイル選択問題のデバッグガイド

## 🔍 原因の特定手順

### ステップ1: ブラウザの開発者ツールで実際のHTMLを確認

1. **開発者ツールを開く**
   - `F12` または `Cmd+Option+I` (Mac) / `Ctrl+Shift+I` (Windows)
   - または、右クリック → 「検証」/「Inspect」

2. **Elements タブで確認**
   - `Cmd+F` (Mac) / `Ctrl+F` (Windows) で検索ボックスを開く
   - `type="file"` または `accept` で検索
   - ファイル入力要素（`<input type="file">`）を見つける

3. **`accept` 属性の値を確認**
   - 期待される値: `accept="*/*"`
   - もし異なる値が表示されている場合、キャッシュの問題か、デプロイが反映されていない可能性があります

**スクリーンショットを撮影して確認してください**

---

### ステップ2: Vercelのデプロイ状況を確認

1. **Vercel Dashboard にアクセス**
   - https://vercel.com/dashboard
   - プロジェクト「carebridge-hub」を開く

2. **最新のデプロイメントを確認**
   - 「Deployments」タブを開く
   - 最新のデプロイメントが「Ready」状態になっているか確認
   - 最新のデプロイメントの時刻を確認

3. **デプロイメントのログを確認**
   - 最新のデプロイメントをクリック
   - 「Build Logs」を確認
   - エラーがないか確認

**確認事項**:
- [ ] 最新のデプロイメントが「Ready」状態
- [ ] デプロイメントの時刻が、コード変更後である
- [ ] ビルドログにエラーがない

---

### ステップ3: ブラウザのキャッシュを完全にクリア

#### Chrome / Edge の場合

1. **開発者ツールを開いた状態で**
   - リロードボタンを右クリック
   - 「キャッシュの消去とハード再読み込み」を選択

2. **または、設定から完全にクリア**
   - `Cmd+Shift+Delete` (Mac) / `Ctrl+Shift+Delete` (Windows)
   - 「キャッシュされた画像とファイル」にチェック
   - 「全期間」を選択
   - 「データを消去」をクリック

3. **シークレットモードで試す**
   - `Cmd+Shift+N` (Mac) / `Ctrl+Shift+N` (Windows)
   - シークレットウィンドウで本番環境にアクセス
   - ファイル選択ダイアログを開く

#### Safari の場合

1. **開発メニューを有効化**（まだの場合）
   - Safari → 環境設定 → 詳細
   - 「メニューバーに"開発"メニューを表示」にチェック

2. **キャッシュをクリア**
   - 開発 → キャッシュを空にする
   - または、`Cmd+Option+E`

3. **ハードリロード**
   - `Cmd+Option+R`

---

### ステップ4: 別のブラウザで試す

**推奨ブラウザ**:
1. **Safari**（macOS）: HEIC ファイルのサポートが最も良好
2. **Chrome**: 一般的に広く使用されている
3. **Firefox**: 別の実装を使用しているため、動作が異なる場合がある

**テスト手順**:
1. 各ブラウザで本番環境にアクセス
2. `/clients/[id]/profile` ページを開く
3. 「書類を追加」ボタンをクリック
4. ファイル選択ダイアログで HEIC、MP4、MOV ファイルが選択可能か確認

**結果を記録**:
- Safari: ✅ / ❌
- Chrome: ✅ / ❌
- Firefox: ✅ / ❌

---

### ステップ5: ネットワークタブでリクエストを確認

1. **開発者ツールの Network タブを開く**
   - 「書類を追加」ボタンをクリックする前に Network タブを開く

2. **ページをリロード**
   - `Cmd+R` (Mac) / `Ctrl+R` (Windows)

3. **JavaScript ファイルを確認**
   - フィルターで「JS」を選択
   - `ClientDocumentsCard` や `page` を含むファイルを探す
   - ファイルをクリックして「Response」タブを開く
   - `accept="*/*"` が含まれているか確認

**確認事項**:
- [ ] JavaScript ファイルに `accept="*/*"` が含まれている
- [ ] ファイルの更新時刻が最新である

---

### ステップ6: コンソールでエラーを確認

1. **開発者ツールの Console タブを開く**
2. **「書類を追加」ボタンをクリック**
3. **エラーメッセージがないか確認**

**確認すべきエラー**:
- JavaScript のエラー
- ファイル選択に関するエラー
- その他の警告メッセージ

---

## 🔧 追加の確認事項

### 1. ローカル環境で確認

もしローカル環境で開発している場合：

1. **ローカル環境で動作確認**
   ```bash
   npm run dev
   ```
2. **http://localhost:3000/clients/[id]/profile にアクセス**
3. **ファイル選択ダイアログで HEIC、MP4、MOV が選択可能か確認**

**結果**:
- ローカル環境で動作する → デプロイの問題
- ローカル環境でも動作しない → コードの問題

---

### 2. ファイル選択ダイアログの動作確認

macOSのファイル選択ダイアログでは、以下の動作を確認してください：

1. **「オプションを表示」ボタンをクリック**
   - ファイル選択ダイアログの左下にある「オプションを表示」ボタンをクリック
   - 追加のオプションが表示されるか確認

2. **ファイルタイプのフィルターを確認**
   - オプションでファイルタイプのフィルターが設定されていないか確認

---

### 3. 実際のファイルでテスト

1. **HEIC ファイル**
   - 実際の HEIC ファイル（`.heic` または `.heif`）を用意
   - ファイル選択ダイアログで選択を試みる

2. **MP4 ファイル**
   - 実際の MP4 ファイルを用意
   - ファイル選択ダイアログで選択を試みる

3. **MOV ファイル**
   - 実際の MOV ファイルを用意
   - ファイル選択ダイアログで選択を試みる

**結果を記録**:
- HEIC: ✅ / ❌
- MP4: ✅ / ❌
- MOV: ✅ / ❌

---

## 📝 確認結果の記録

以下の情報を記録してください：

### ブラウザ情報
- ブラウザ名とバージョン: _______________
- OS: _______________

### 開発者ツールでの確認結果
- `accept` 属性の値: _______________
- JavaScript ファイルに `accept="*/*"` が含まれている: ✅ / ❌
- コンソールにエラーが表示されている: ✅ / ❌
- エラーメッセージ（あれば）: _______________

### Vercel のデプロイ状況
- 最新のデプロイメントの時刻: _______________
- デプロイメントの状態: _______________
- ビルドログにエラーがある: ✅ / ❌

### ブラウザ別の動作確認
- Safari: ✅ / ❌
- Chrome: ✅ / ❌
- Firefox: ✅ / ❌

### ファイルタイプ別の動作確認
- HEIC: ✅ / ❌
- MP4: ✅ / ❌
- MOV: ✅ / ❌

---

## 🎯 次のステップ

確認結果に基づいて、以下のいずれかの対応を行います：

1. **キャッシュの問題の場合**
   - ブラウザのキャッシュを完全にクリア
   - シークレットモードで試す

2. **デプロイの問題の場合**
   - Vercel で再デプロイ
   - デプロイメントのログを確認

3. **コードの問題の場合**
   - コードを再確認
   - 別のアプローチを試す

4. **ブラウザ固有の問題の場合**
   - 別のブラウザで試す
   - ブラウザの設定を確認

---

## 💡 追加の対処法

### 方法1: `accept` 属性を完全に削除

もし `accept="*/*"` でも動作しない場合、`accept` 属性を完全に削除することも検討できます。

**注意**: この場合、クライアント側のバリデーションが重要です。

### 方法2: 複数のファイル入力を使用

画像用、動画用、ドキュメント用に別々のファイル入力を使用する方法もあります。

### 方法3: ドラッグ&ドロップを追加

ファイル選択ダイアログに頼らず、ドラッグ&ドロップでファイルをアップロードする方法もあります。

---

## 📞 サポート

確認結果を共有していただければ、より具体的な対処法を提案できます。

特に以下の情報があると助かります：
1. 開発者ツールで確認した `accept` 属性の値
2. Vercel の最新デプロイメントの状態
3. ブラウザ別の動作確認結果
4. コンソールに表示されたエラーメッセージ






