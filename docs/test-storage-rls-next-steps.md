# Storage RLSポリシーテスト - 次のステップ

## ✅ 現在の状況

施設とクライアントの作成が完了しました：
- **facility_id**: `58fedddc-9b8c-48b0-bb9a-fdc5792c13fc`
- **client_id**: `f876abe4-c581-48b1-add6-0089456c7a36`

この`client_id`を使用して、Storage RLSポリシーのテストを実行できます。

---

## 🚀 テスト実行手順

### ステップ1: ブラウザでアプリにアクセス

1. ブラウザで `https://carebridge-hub.vercel.app` にアクセス
2. **ログイン**してください（重要：認証が必要です）
3. **F12**キーで開発者ツールを開く
4. **Console**タブを選択

### ステップ2: テストスクリプトを読み込む

1. `docs/test-storage-rls-console-scripts.js` を開く
2. **すべての内容をコピー**（Ctrl+A → Ctrl+C）
3. ブラウザのConsoleタブに**貼り付け**（Ctrl+V）
4. **Enter**キーを押す

以下のメッセージが表示されれば成功：
```
✅ Storage RLSポリシー動作確認スクリプトが読み込まれました
```

### ステップ3: テストを実行

Consoleタブに以下を入力（取得した`client_id`を使用）：

```javascript
runAllRLSTests('f876abe4-c581-48b1-add6-0089456c7a36');
```

**Enter**キーを押して実行

### ステップ4: 結果を確認

以下のような出力が表示されれば成功：

```
🚀 Storage RLSポリシーの動作確認テストを開始します...

📤 テスト1: 自分の施設のクライアントファイルをアップロード
✅ ファイルアップロード成功!

📥 テスト2: 自分の施設のクライアントファイルを読み取る
✅ ダウンロード成功!

✅ すべてのテストが成功しました！RLSポリシーは正しく動作しています。
```

---

## 📝 個別テスト（オプション）

### ファイルをアップロード

```javascript
uploadClientTestFile('f876abe4-c581-48b1-add6-0089456c7a36');
```

### ファイルを読み取る

```javascript
testDownloadOwnFacilityFile('f876abe4-c581-48b1-add6-0089456c7a36/rls-test-file.txt');
```

### 現在のユーザー情報を確認

```javascript
showCurrentUserInfo();
```

---

## ⚠️ 注意事項

- **ログイン必須**: テストを実行する前に、必ずアプリにログインしてください
- **認証エラー**: ログインしていない場合、Storageへのアクセスは拒否されます
- **client_id**: 上記の`client_id`を使用してください（あなたの環境で取得したID）

---

## ✅ 成功の基準

以下のすべてが満たされていれば、RLSポリシーは正しく動作しています：

1. ✅ **テスト1**: 自分の施設のクライアントファイルがアップロードできる
2. ✅ **テスト2**: 自分の施設のクライアントファイルが読み取れる

---

## 📚 詳細なガイド

より詳細な説明が必要な場合は、以下を参照してください：
- `docs/test-storage-rls-quick-start.md` - クイックスタートガイド
- `docs/test-storage-rls-policy.md` - 詳細ガイド










